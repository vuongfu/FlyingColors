@model TutorOnline.Web.Models.TutorInfoViewModels
<script src="~/Scripts/jquery-3.1.1.js"></script>
@{
    ViewBag.Title = "Chi tiết gia sư";
    Layout = "~/Views/Shared/_Layout_BackendUser.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <h3 style="margin-bottom: -40px;">Chi tiết gia sư</h3>
            @if (ViewBag.comeFrom == "Index")
            {
                @Html.ActionLink("Trở lại", "Index", "TutorManagement", null, new { @class = "btn btn-info pull-right" })
            }
            else
            {
                @Html.ActionLink("Trở lại", "TutorSignMoreSubIndex", "TutorManagement", null, new { @class = "btn btn-info pull-right" })
            }
        </div>
    </div>
    <hr />
    <div class="panel panel-primary">
        <div class="panel-heading">
            <strong>Gia sư: </strong>@Html.DisplayFor(model => model.FullName)
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-2">
                    @if (String.IsNullOrEmpty(Model.Photo))
                    {
                        @("N/A")
                    }
                    else
                    {
                        <img src="~/Content/Uploads/Images/Thumbnails/@Model.Photo.Substring(3)" class="img-circle" width="90" height="90" />
                    }
                </div>
                <div class="col-md-10">
                    <div class="row">
                        <h4 style="color:deepskyblue">Thông tin gia sư</h4>
                        <table class="table">
                            <tr>
                                <td><strong>Họ và tên:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.FullName)</td>
                            </tr>
                            <tr>
                                <td><strong>Giới tính:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.Gender)</td>
                            </tr>
                            <tr>
                                <td><strong>Ngày sinh:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.BirthDate)</td>
                            </tr>
                            <tr>
                                <td><strong>Địa chỉ:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.Address)</td>
                            </tr>
                            <tr>
                                <td><strong>Thành phố:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.City)</td>
                            </tr>
                            <tr>
                                <td><strong>Quốc gia:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.Country)</td>
                            </tr>
                            <tr>
                                <td><strong>Mã bưu chính:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.PostalCode)</td>
                            </tr>
                            <tr>
                                <td><strong>Email:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.Email)</td>
                            </tr>
                            <tr>
                                <td><strong>Skype:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.SkypeId)</td>
                            </tr>
                            <tr>
                                <td><strong>Số điện thoại:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.PhoneNumber)</td>
                            </tr>
                            <tr>
                                <td><strong>Số tài khoản:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.BankId)</td>
                            </tr>
                            <tr>
                                <td><strong>Tên chủ thẻ:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.BMemName)</td>
                            </tr>
                            <tr>
                                <td><strong>Tên ngân hàng:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.BankName)</td>
                            </tr>
                            <tr>
                                <td><strong>Lương/1 buổi dạy:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">
                                    @Html.DisplayFor(model => model.Salary) vnđ
                                    <p />
                                    <input type="button" class="btn btn-info" id="btnSalary" value="Chỉnh sửa" />
                                    <p id="msgSalary" style="color: orangered"></p>
                                    <input type="text" id="salarytbox" name="salaryTextBox" style="display:none" placeholder="Hãy nhập số tiền..." required>
                                    <input type="button" class="btn btn-success" id="btnSaEdited" style="display:none; margin-top:10px;" value="Cập nhật" onclick="EditSalary()" />
                                    <input type="button" class="btn btn-danger pull-right" id="btnSaCanceled" style="display:none; margin-top: -32px; margin-right: 30px;" value="Hủy" onclick="CancelSalary()" />
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Mô tả:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.Description)</td>
                            </tr>
                            <tr>
                                <td><strong>Ngày được phê duyệt:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.RegisterDate)</td>
                            </tr>
                            <tr>
                                <td><strong>Trạng thái:</strong></td>
                                <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(model => model.isActived)</td>
                            </tr>
                        </table>
                        <hr />
                        <h4 style="color:deepskyblue">Những khóa học đang dạy</h4>
                        @foreach (var item in Model.tutorSub)
                        {
                            <table class="table">
                                <tr>
                                    <td><strong>Tên khóa dạy:</strong></td>
                                    <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(modelItem => item.subjectName)</td>
                                </tr>
                                <tr>
                                    <td><strong>Kinh nghiệm:</strong></td>
                                    <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(modelItem => item.experiences)</td>
                                </tr>
                            </table>
                        }

                        <hr />

                        <h4 style="color: deepskyblue">Những khóa dạy chưa được phê duyệt</h4>
                            @if (Model.newTutorSub.Count != 0)
                            {
                                foreach (var item in Model.newTutorSub)
                                {
                                    <table class="table">
                                        <tr>
                                            <td><strong>Tên khóa dạy:</strong></td>
                                            <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(modelItem => item.subjectName)</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Kinh nghiệm:</strong></td>
                                            <td class="text-left" style="padding-right: 300px;">@Html.DisplayFor(modelItem => item.experiences)</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <a href="@Url.Action("ApprovedSubject", "TutorManagement", new { subId = item.TutorSubjectId, tuId = Model.TutorId })" class="btn btn-success">Phê duyệt</a> | 
                                                <a href="@Url.Action("RejectedSubject", "TutorManagement", new { tusubId = item.TutorSubjectId, tuId = Model.TutorId })" class="btn btn-danger">Từ chối</a>
                                            </td>
                                            <td></td>
                                        </tr>
                                    </table>
                                   
                                }
                            }
                            else
                            {
                                <h5 style="color: black;"><strong>Không có khóa dạy nào đăng ký mới.</strong></h5>
                            }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    document.getElementById('btnSalary').onclick = function() {
        document.getElementById("btnSalary").style.display='none';
        document.getElementById("salarytbox").style.display='block';
        document.getElementById("btnSaEdited").style.display='block';
        document.getElementById("btnSaCanceled").style.display='block';
        document.getElementById("msgSalary").style.display='block';
    }
    document.getElementById('btnSaCanceled').onclick = function() {
        document.getElementById("salarytbox").style.display='none';
        document.getElementById("btnSaEdited").style.display='none';
        document.getElementById("btnSaCanceled").style.display='none';
        document.getElementById("msgSalary").innerHTML = "";
        document.getElementById("salarytbox").value = '';
        document.getElementById("msgSalary").style.display='none';
        document.getElementById("btnSalary").style.display='block';
    }
    function EditSalary() {
        var tuId = @Model.TutorId;
        @{int tuId = Model.TutorId;}
        var salary = document.getElementById("salarytbox").value;
        if(salary == "") {
            document.getElementById("msgSalary").innerHTML = "Bạn chưa nhập số tiền.";
        }
        else if(salary > 10000000)
            document.getElementById("msgSalary").innerHTML = "Số tiền phải nằm trong khoảng từ 0 đến 10 triệu vnđ.";
        else {
            $.ajax({
                url: '@Url.Action("EditTuSalary", "TutorManagement")',
                dataType: "json",
                type: "POST",
                contentType: 'application/json; charset=utf-8',
                traditional: true,
                data: JSON.stringify({ 'salary': salary, 'tuId': tuId }),
                success: function (response) {
                    if(response.UpdatedSalary == true){
                        document.getElementById("salarytbox").value = '';
                        window.location.href = '@Url.Action("DetailsTutorSignMoreSub", "TutorManagement", new { id = tuId })';
                    }
                }
            });
        }
    }
</script>
